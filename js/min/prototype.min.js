!function(){var n,e,i,t;i=function(n){var e,i;return n=$(n),i=n.offset().top,e=function(){return i<$(this).offset().top},$.merge(n,n.nextUntil(e)).last()},e=function(n,e){return n.length>0&&e.length>0&&n.offset().top===e.offset().top},n=function(){var n;return n=null,function(e,i){return n&&n.abort(),n=$.getJSON(e,function(n){return i(n)})}}(),t=function(n,e,i,t){var a,r,s,o,d,u;return u=$(window).innerWidth(),o=e+i,d=u-2*t+i,r=Math.floor(d/o),a=u-(r*o-i),s=Math.floor(a/2),n.css({"margin-right":0,"margin-left":i}),n.each(function(n){return 0===n%r?$(this).css({"margin-left":s}):void 0})},$(function(){var n,a,r,s,o,d,u,l,c,h,p,v,f,m,g,b,_,x,y;return s=$(".exhibits>li.exhibit"),_=59,y=s.width(),x=parseInt(s.css("margin-left"))+parseInt(s.css("margin-right")),$(".exhibits").css({"text-align":"left"}),t(s,y,x,_),$(window).resize(t.bind(this,s,y,x,_)),d=$("#drop_down").remove().removeClass("hidden"),g=[],c=function(){return $("ul.exhibits li.active")},l=function(n){var e;return d.find("p").html(n.description),n.images.length>1?(e=n.images.map(function(n){return'<img src="'+n.big_url+'">'}).join(""),d.find(".slides").html(e).slidesjs(slidesjs_options)):void 0},r=function(){var n,e,i,t,a,r,s;if(n=c(),n.hasClass("dummy")&&""===d.find("#name").val()){for(t=!0,s=d.find("#media .form-control:not(#opas_number)"),a=0,r=s.length;r>a;a++)e=s[a],e=$(e),""!==e.val()&&(t=!1);t?n.remove():(i=n.data("number"),$("ul.exhibits").append(v(i)),$("#dummyModal").modal({show:!0,backdrop:"static"}),$("#dummyModal").find(".btn-default").click(function(){return n.remove(),$("#dummyModal, .modal-backdrop").remove()}),$("#dummyModal").find(".btn-primary").click(function(){return n.removeClass("dummy"),d.find("#name").val("item_"+i),n.find(".opener").removeClass("draft"),$("#dummyModal, .modal-backdrop").remove()}))}return d.remove(),n.removeClass("active")},a=function(n){var e;return e=d.parent().length>0,d.insertAfter(i(n)),e?void 0:(d.find("a.done").unbind("click").bind("click",function(n){return n.preventDefault(),r()}),d.find(">.prev-ex").unbind("click").bind("click",function(n){var e,i;return n.preventDefault(),e=c(),i=e.prev(".exhibit"),"drop_down"===i.attr("id")&&(i=i.prev()),i.length>0?i.find(".opener .description").click():e.siblings(".exhibit").last().find(".opener").click()}),d.find(">.next-ex").unbind("click").bind("click",function(n){var e,i;return n.preventDefault(),e=c(),i=e.next(),"drop_down"===i.attr("id")&&(i=i.next()),i.length>0?i.find(".opener .description").click():e.siblings(".exhibit").first().find(".opener").click()}),d.find(".label-content").unbind("click").bind("click",function(){var n,e;return n=$(this),e=n.parents(".dropdown-menu").prev(".dropdown-toggle"),n.hasClass("everyone")?e.html("<div class='extra'><i class='icon-globe'></i></div><span class='caret'></span>"):e.html("<div class='extra'><i class='icon-user'></i></div> Publish <span class='caret'></span>")}),d.find("#lang_selected").unbind("change").bind("change",function(){var n;return n=$(this),n.is(":checked")?n.parents(".form-group").next().show():void 0}))},$(window).resize(function(){return c().each(function(){return d.remove(),a(this)}),f(),u()}),p=function(n){return $(".icon-question-sign").each(function(){return $(this).is(n)||0!==$(this).has(n).length||0!==$(".popover").has(n).length?void 0:$(this).popover("hide")})},u=function(){return $(".form-group").each(function(n,e){var i;return e=$(e),i=e.find(".triggered > *").val(),e.find("span.placeholder").text(i),e.find(".save_status").html('<i class="icon-ok-sign"></i>saved'),""===i?(e.find(".trigger").hide(),e.find(".triggered").show().focus()):void 0}),$("span.placeholder").unbind("click").bind("click",function(){var n,e,i;return n=$(this),e=n.parents(".trigger"),i=e.next(),e.hide(),i.show().children().first().val(n.text()).focus()}),$(".triggered > *").unbind("blur").bind("blur",function(){var n,e,i,t;return n=$(this),""!==n.val()?(e=n.parents(".triggered"),t=e.prev(),e.hide(),t.show().find("span").text(n.val()),i=t.parent(".form-group").find(".save_status"),i.fadeIn(300),setTimeout(function(){return i.fadeOut(300)},800)):void 0}),$("i.icon-question-sign").popover(),$(".form-group").unbind("mouseenter").bind("mouseenter",function(n){return p(n.target)}),$("body").on("click",function(n){return p(n.target)}),$("a.other_lang").unbind("click").bind("click",function(){var n;return n=$(this),n.next("ul").toggleClass("hidden"),!1})},f=function(){var n,e,i,t;return e=$("ul.museum_list"),n=e.find("li").length,t=$("body").width(),i=(150*n+160)/t,i>1?($(".museum_filters").show(),e.width(t-200)):($(".museum_filters").hide(),e.width(t-100))},m=function(){return $(".museum_navigation_menu .search").click(function(){var n;return n=$(this),n.hide(),n.next().show().children().first().focus()}),$(".museum_navigation_menu .search_input input").blur(function(){var n,e;return n=$(this),e=n.parents(".search_input"),n.animate({width:"150px"},150,function(){return e.hide(),e.prev().show()})}),$(".museum_navigation_menu .search_input input").focus(function(){var n,e;return n=$(this),e=$("body").width()-700,e>150?n.animate({width:""+e+"px"},300):void 0}),$(".museum_navigation_menu .search_input input").keyup(function(){var n,e,i,t,a,r,s,o;for(e=$(this),a=e.val().toLowerCase(),t=$("ul.museum_list > li"),0!==a.length?$(".museum_filters a").removeClass("active"):$(".museum_filters a").first().addClass("active"),o=[],n=r=0,s=g.length;s>r;n=++r)i=g[n],-1===i.indexOf(a)?o.push($(t[n]).hide(100)):o.push($(t[n]).show(100));return o}),$(".museum_navigation_menu .search_input .search_reset").click(function(){return $(".museum_navigation_menu .search_input input").val("").keyup()})},o=function(){var n,e,i,t,a;for(e=$("ul.museum_list > li"),a=[],i=0,t=e.length;t>i;i++)n=e[i],n=$(n),a.push(g.push(""+n.find("h4").text().trim().toLowerCase()));return a},f(),o(),m(),$(".filter_opener").click(function(n){var e,i,t;return n.preventDefault(),e=$(this),i=$(".filters_bar"),t=$(".navigation"),e.hasClass("active")?(i.css({overflow:"hidden"}),i.animate({height:"0px"},200),e.removeClass("active"),t.hasClass("navbar-fixed-top")?$("body").animate({"padding-top":"-=44px"},200):void 0):(i.animate({height:"44px"},200,function(){return i.css({overflow:"visible"})}),t.hasClass("navbar-fixed-top")&&$("body").animate({"padding-top":"+=44px"},200),e.addClass("active"))}),$(".menu_opener").click(function(){var n,e,i,t;return n=$(this),e=$(".museum_navigation_menu"),i=$(".navigation"),e.is(":visible")?(t=n.data("last-padding"),e.slideUp(300),i.addClass("navbar-fixed-top"),$("body").css({"padding-top":""+t})):(t=$("body").css("padding-top"),n.data("last-padding",t),e.slideDown(300),i.removeClass("navbar-fixed-top"),$("body").css({"padding-top":"0px"}))}),$("ul.exhibits>li:not(#drop_down) .checkbox input").change(function(){var n,e;return n=$(this),e=n.parents(".opener"),n.is(":checked")?e.addClass("border"):e.removeClass("border")}),$(".actions_bar input.search").focus(function(){var n,e;return n=$(this),e=$("body").width()-700,e>150?n.animate({width:""+e+"px"},300):void 0}),$(".actions_bar input.search").blur(function(){var n;return n=$(this),n.animate({width:"150px"},300)}),n=function(){return $("ul.exhibits>li:not(#drop_down)>.opener .description, ul.exhibits>li:not(#drop_down)>.opener .overlay").unbind("click").bind("click",function(){var n,i,t,s;return n=$(this).closest("li"),n.hasClass("active")?(r(),!1):(t=c(),t.removeClass("active"),n.addClass("active"),s=$("<div>").addClass("slides").html('<img src="'+n.data("big-image")+'">'),s.appendTo(d.find(".images").html("")),d.find("h2").text(n.find("h4").text()),e(n,t)||(a(n),$("body").scrollTo(n,500,150)),u(),$("#jquery_jplayer_1").jPlayer({ready:function(){return $(this).jPlayer("setMedia",{m4a:"http://www.jplayer.org/audio/m4a/TSP-01-Cro_magnon_man.m4a",oga:"http://www.jplayer.org/audio/ogg/TSP-01-Cro_magnon_man.ogg"})},swfPath:"/js",wmode:"window",preload:"auto",smoothPlayBar:!0,keyEnabled:!0,supplied:"m4a, oga"}),n.hasClass("dummy")?(i=n.data("number"),$("#opas_number").val(i).blur(),$("#name").focus()):void 0)})},n(),v=function(n){return'<div class="modal fade" id=\'dummyModal\'>\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        <h4 class="modal-title">Name of exhibit is empty</h4>\n      </div>\n      <div class="modal-body row">\n        <div class="pull-right">\n          <button type="button" class="btn btn-default" data-dismiss="modal">Discard exhibit</button>\n          <button type="button" class="btn btn-primary" data-dismiss="modal">Save as "item_'+n+'"</button>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'},b=function(n){return'<li class="exhibit dummy" data-big-image=/img/img-bg.png" data-number=\''+n+'\'>\n  <div class="opener draft">\n    <div class="overlay"></div>\n    <div class="checkbox">\n      <input type="checkbox">\n    </div>\n    <div class="image">\n      <img data-src="" src="/img/img-bg.png">\n    </div>\n    <div class="description">\n      <h4>\n        '+n+". item_"+n+'\n      </h4>\n    </div>\n    <div class="visibility">\n      <i class="icon-globe placeholder"></i>\n      <div class="on_hover">\n        <div class="btn-group">\n          <button class="btn btn-default dropdown-toggle" data-toggle="dropdown" type="button">\n            <div class="extra_right">\n              <i class="icon-globe"></i>\n            </div>\n            <span class="caret"></span></button>\n          <ul class="dropdown-menu" role="menu">\n            <div class="status-select-dropdown">\n              <form accept-charset="UTF-8" action="/1/museums/1/exhibits/8" class="simple_form status-select-inline" data-remote="true" id="edit_exhibit_8" method="post" novalidate="novalidate">\n                <div style="margin:0;padding:0;display:inline">\n                  <input name="utf8" type="hidden" value="âœ“"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="oE0Ns9ypDjsWQrc0VHdsAqhAgEz0Q8Lx8pJQlyqQaq0=">\n                </div>\n                <div class="status-select control-group radio_buttons required">\n                  <label class="radio_buttons required control-label">\n                    <div class="required-symbol">\n                      <abbr title="required"></abbr>\n                    </div>\n                    Who can see it in mobile application</label>\n                  <div class="controls">\n                    <div>\n                      <input checked="checked" class="radio_buttons required radio" data-status-text="Published" id="exhibit_8_status_published" name="exhibit[status]" type="radio" value="published"><label class="radio" for="exhibit_8_status_published">\n                        <div class="label-content">\n                          <i class="icon-globe"></i> Everyone\n                        </div>\n                      </label>\n                    </div>\n                    <div>\n                      <input class="radio_buttons required radio" data-status-text="Limited" id="exhibit_8_status_limited" name="exhibit[status]" type="radio" value="limited"><label class="radio" for="exhibit_8_status_limited">\n                        <div class="label-content">\n                          <i class="icon-user"></i> Only users who have passcode\n                        </div>\n                      </label>\n                      <div class="limited-pass-hint hidden">\n                        <div class="limited-pass">\n                          pzicen\n                        </div>\n                        <a href="/1/content_provider/edit#passcode" target="_blank">Edit</a>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </form>\n            </div>\n          </ul>\n        </div>\n      </div>\n    </div>\n  </div>\n</li>'},h=function(){return Math.round(10*Math.random()+11)},$("#create_new_item").click(function(){var e,i,t;return e=$("ul.exhibits"),e.find("li.dummy").length>0?!1:(t=h(),i=b(t),e.append(i),n(),e.find("li.dummy").find(".opener .description").click(),d.find("#name").blur(function(){var n,e;return e=$(this),""!==e.val()?(n=c(),n.removeClass("dummy").find(".opener").removeClass("draft")):void 0}),!1)})})}.call(this);