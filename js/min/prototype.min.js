(function(){var e,i,n,t;n=function(e){var i,n;return e=$(e),n=e.offset().top,i=function(){return n<$(this).offset().top},$.merge(e,e.nextUntil(i)).last()},i=function(e,i){return e.length>0&&i.length>0&&e.offset().top===i.offset().top},e=function(){var e;return e=null,function(i,n){return e&&e.abort(),e=$.getJSON(i,function(e){return n(e)})}}(),t=function(e,i,n,t){var a,s,r,d,o,l;return l=$(window).innerWidth(),d=i+n,o=l-2*t+n,s=Math.floor(o/d),a=l-(s*d-n),r=Math.floor(a/2),e.css({"margin-right":0,"margin-left":n}),e.each(function(e){return 0===e%s?$(this).css({"margin-left":r}):void 0})},$(function(){var e,a,s,r,d,o,l,u,c,m,h,p,f,v,b,g,_,y,x,w,k,C,q,j,D;return r=$(".exhibits>li.exhibit"),C=59,j=r.width(),q=parseInt(r.css("margin-left"))+parseInt(r.css("margin-right")),$(".exhibits").css({"text-align":"left"}),t(r,j,q,C),$(window).resize(t.bind(this,r,j,q,C)),$.fn.refresh=function(){return $(this.selector)},$.fn.isEmpty=function(){return 0===this.length},o=$("#drop_down").removeClass("hidden").hide(),_=[],m=function(){return $("ul.exhibits li.exhibit.active")},c=function(e){var i;return o.find("p").html(e.description),e.images.length>1?(i=e.images.map(function(e){return'<img src="'+e.big_url+'">'}).join(""),o.find(".slides").html(i).slidesjs(slidesjs_options)):void 0},l=function(e){var i,n,t,a,s,r;if(""===o.find("#name").val()){for(t=!0,r=o.find("#media .form-control:not(#opas_number)"),a=0,s=r.length;s>a;a++)i=r[a],i=$(i),""!==i.val()&&(t=!1);return t?e.remove():(n=e.data("number"),$("ul.exhibits").append(f(n)),$("#dummyModal").modal({show:!0,backdrop:"static"}),$("#dummyModal").find(".btn-default").click(function(){return e.remove(),$("#dummyModal, .modal-backdrop").remove()}),$("#dummyModal").find(".btn-primary").click(function(){return e.removeClass("dummy"),o.find("#name").val("item_"+n),e.find(".opener").removeClass("draft"),$("#dummyModal, .modal-backdrop").remove()}))}},s=function(){var e;return e=m(),e.hasClass("dummy")&&l(e),o.hide(),e.removeClass("active")},a=function(e){var i;return i=o.hasClass("inited"),o.show().insertAfter(n(e)),i?void 0:(o.addClass("inited"),o.find("a.done, .close").unbind("click").bind("click",function(e){return e.preventDefault(),s()}),o.find(">.prev-ex").unbind("click").bind("click",function(e){var i,n;return e.preventDefault(),i=m(),n=i.prev(".exhibit"),"drop_down"===n.attr("id")&&(n=n.prev()),n.length>0?n.find(".opener .description").click():i.siblings(".exhibit").last().find(".opener").click()}),o.find(">.next-ex").unbind("click").bind("click",function(e){var i,n;return e.preventDefault(),i=m(),n=i.next(),"drop_down"===n.attr("id")&&(n=n.next()),n.length>0?n.find(".opener .description").click():i.siblings(".exhibit").first().find(".opener").click()}),o.find(".label-content").unbind("click").bind("click",function(){var e,i;return e=$(this),i=e.parents(".dropdown-menu").prev(".dropdown-toggle"),e.hasClass("everyone")?i.html("<div class='extra'><i class='icon-globe'></i></div> Published <span class='caret'></span>"):i.html("<div class='extra'><i class='icon-user'></i></div> Publish <span class='caret'></span>")}),o.find("#delete_story input[type=radio]").unbind("change").bind("change",function(){var e,i;return i=$(this),e=$("#delete_story"),"lang_selected"!==i.attr("id")?$("#delete_story .other_variants").slideUp(150):i.is(":checked")?$("#delete_story .other_variants").slideDown(150):void 0}),$("#story_quiz_enabled, #story_quiz_disabled").unbind("change").bind("change",function(){var e,i;return e=$(this),i=o.find(".form-wrap"),console.log(e.val()),"story_quiz_enabled"===e.attr("id")?($("label[for=story_quiz_enabled]").text("Enabled"),$("label[for=story_quiz_disabled]").text("Disable"),!0):($("label[for=story_quiz_disabled]").text("Disabled"),$("label[for=story_quiz_enabled]").text("Enable"),!0)}),o.find("a.delete_story").unbind("click").bind("click",function(e){var i;return i=$(this),i.hasClass("no_margin")?(e.preventDefault(),e.stopPropagation(),s()):void 0}))},$(window).resize(function(){return m().each(function(){return o.hide(),a(this)}),b()}),p=function(e){return $(".icon-question-sign").each(function(){return $(this).is(e)||0!==$(this).has(e).length||0!==$(".popover").has(e).length?void 0:$(this).popover("hide")})},u=function(){return $(".form-group").each(function(e,i){var n;return i=$(i),n=i.find(".triggered > *").val(),i.find("span.placeholder").text(n),i.find(".save_status").html('<i class="icon-ok-sign"></i>saved'),""===n?(i.find(".trigger").hide(),i.find(".triggered").show().focus()):void 0}),$("span.placeholder").unbind("click").bind("click",function(){var e,i,n;return e=$(this),i=e.parents(".trigger"),n=i.next(),i.hide(),n.show().children().first().val(e.text()).focus()}),$(".triggered > *").unbind("blur").bind("blur",function(){var e,i,n,t,a;return e=$(this),i=e.parents(".triggered"),t=i.prev(),""!==e.val()&&(i.hide(),t.show().find("span").text(e.val())),n=Math.round(Math.random())>0,a=0,n&&(a=1e3),i=t.parent(".form-group"),n&&i.append("<div class='preloader'></div>"),setTimeout(function(){var e;return e=i.find(".save_status"),n&&i.find(".preloader").remove(),e.fadeIn(300),setTimeout(function(){return e.fadeOut(300)},800)},a)}),$("i.icon-question-sign").popover(),$(".form-group").unbind("mouseenter").bind("mouseenter",function(e){return p(e.target)}),$("body").on("click",function(e){return p(e.target)}),$("a.other_lang").unbind("click").bind("click",function(){var e;return e=$(this),e.next("ul").toggleClass("hidden"),!1})},b=function(){var e,i,n,t;return i=$("ul.museum_list"),e=i.find("li").length,t=$("body").width(),n=(150*e+160)/t,n>1?($(".museum_filters").show(),i.width(t-200)):($(".museum_filters").hide(),i.width(t-100))},g=function(){return $(".museum_navigation_menu .search").click(function(){var e;return e=$(this),e.hide(),e.next().show().children().first().focus()}),$(".museum_navigation_menu .search_input input").blur(function(){var e,i;return e=$(this),i=e.parents(".search_input"),e.animate({width:"150px"},150,function(){return i.hide(),i.prev().show()})}),$(".museum_navigation_menu .search_input input").focus(function(){var e,i;return e=$(this),i=$("body").width()-700,i>150?e.animate({width:""+i+"px"},300):void 0}),$(".museum_navigation_menu .search_input input").keyup(function(){var e,i,n,t,a,s,r,d;for(i=$(this),a=i.val().toLowerCase(),t=$("ul.museum_list > li"),0!==a.length?$(".museum_filters a").removeClass("active"):$(".museum_filters a").first().addClass("active"),d=[],e=s=0,r=_.length;r>s;e=++s)n=_[e],-1===n.indexOf(a)?d.push($(t[e]).hide(100)):d.push($(t[e]).show(100));return d}),$(".museum_navigation_menu .search_input .search_reset").click(function(){return $(".museum_navigation_menu .search_input input").val("").keyup()})},v=function(){return $(".museum_filters a").click(function(){var e,i;return e=$(this),$(".museum_filters a").removeClass("active"),e.addClass("active"),i=$("ul.museum_list"),e.hasClass("type_tour")?(i.find(">li:not(.tour)").hide(),i.find(">li.tour").show()):e.hasClass("type_museum")?(i.find(" li:not(.museum)").hide(),i.find(">li.museum").show()):i.find(">li").show()})},d=function(){var e,i,n,t,a;for(i=$("ul.museum_list > li"),a=[],n=0,t=i.length;t>n;n++)e=i[n],e=$(e),a.push(_.push(""+e.find("h4").text().trim().toLowerCase()));return a},b(),d(),g(),v(),$(".filter_opener").click(function(e){var i,n,t;return e.preventDefault(),i=$(this),n=$(".filters_bar"),t=$(".navigation"),i.hasClass("active")?(n.css({overflow:"hidden"}),n.animate({height:"0px"},200),i.removeClass("active"),t.hasClass("navbar-fixed-top")?$("body").animate({"padding-top":"-=44px"},200):void 0):(n.animate({height:"44px"},200,function(){return n.css({overflow:"visible"})}),t.hasClass("navbar-fixed-top")&&$("body").animate({"padding-top":"+=44px"},200),i.addClass("active"))}),$(".menu_opener").click(function(){var e,i,n,t;return e=$(this),i=$(".museum_navigation_menu"),n=$(".navigation"),i.is(":visible")?(t=e.data("last-padding"),i.slideUp(300),n.addClass("navbar-fixed-top"),$("body").css({"padding-top":""+t})):(t=$("body").css("padding-top"),e.data("last-padding",t),i.slideDown(300),n.removeClass("navbar-fixed-top"),$("body").css({"padding-top":"0px"}))}),$("ul.exhibits>li:not(#drop_down) .checkbox input").change(function(){var e,i;return e=$(this),i=e.parents(".opener"),e.is(":checked")?i.addClass("border"):i.removeClass("border")}),$(".actions_bar input.search").focus(function(){var e,i;return e=$(this),i=$("body").width()-700,i>150?e.animate({width:""+i+"px"},300):void 0}),$(".actions_bar input.search").blur(function(){var e;return e=$(this),e.animate({width:"150px"},300)}),e=function(){return $("ul.exhibits>li:not(#drop_down)>.opener .description, ul.exhibits>li:not(#drop_down)>.opener .overlay").unbind("click").bind("click",function(){var e,n,t,r,d,c,h;return e=$(this).parents("li"),e.hasClass("active")?(s(),!1):(h=m(),h.hasClass("dummy")&&l(h),h.removeClass("active"),e.addClass("active"),o.find("h2").text(e.find("h4").text()),i(e,h)||(a(e),$("body").scrollTo(e,500,150)),u(),$("#jquery_jplayer_1").jPlayer({ready:function(){return $(this).jPlayer("setMedia",{m4a:"http://www.jplayer.org/audio/m4a/TSP-01-Cro_magnon_man.m4a",oga:"http://www.jplayer.org/audio/ogg/TSP-01-Cro_magnon_man.ogg"})},swfPath:"/js",wmode:"window",preload:"auto",smoothPlayBar:!0,keyEnabled:!0,supplied:"m4a, oga"}),d=o.find(".item_publish_settings"),r=o.find(".done"),n=o.find(".close"),t=o.find(".delete_story"),e.hasClass("dummy")?(c=e.data("number"),$("#opas_number").val(c).blur(),$("#name").focus(),d.hide(),r.hide(),n.show(),t.addClass("no_margin")):(d.show(),r.show(),n.hide(),t.removeClass("no_margin")))})},e(),f=function(e){return'<div class="modal fade" id=\'dummyModal\'>\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        <h4 class="modal-title">Name of exhibit is empty</h4>\n      </div>\n      <div class="modal-body row">\n        <div class="pull-right">\n          <button type="button" class="btn btn-default" data-dismiss="modal">Discard exhibit</button>\n          <button type="button" class="btn btn-primary" data-dismiss="modal">Save as "item_'+e+'"</button>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'},y=function(e){return'<li class="exhibit dummy" data-big-image=/img/img-bg.png" data-number=\''+e+'\'>\n  <div class="opener draft">\n    <div class="overlay"></div>\n    <div class="checkbox">\n      <input type="checkbox">\n    </div>\n    <div class="image">\n      <img data-src="" src="/img/img-bg.png">\n    </div>\n    <div class="description">\n      <h4>\n        '+e+". item_"+e+'\n      </h4>\n    </div>\n    <div class="visibility">\n      <i class="icon-globe placeholder"></i>\n      <div class="on_hover">\n        <div class="btn-group">\n          <button class="btn btn-default dropdown-toggle" data-toggle="dropdown" type="button">\n            <div class="extra_right">\n              <i class="icon-globe"></i>\n            </div>\n            <span class="caret"></span></button>\n          <ul class="dropdown-menu" role="menu">\n            <div class="status-select-dropdown">\n              <form accept-charset="UTF-8" action="/1/museums/1/exhibits/8" class="simple_form status-select-inline" data-remote="true" id="edit_exhibit_8" method="post" novalidate="novalidate">\n                <div style="margin:0;padding:0;display:inline">\n                  <input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="oE0Ns9ypDjsWQrc0VHdsAqhAgEz0Q8Lx8pJQlyqQaq0=">\n                </div>\n                <div class="status-select control-group radio_buttons required">\n                  <label class="radio_buttons required control-label">\n                    <div class="required-symbol">\n                      <abbr title="required"></abbr>\n                    </div>\n                    Who can see it in mobile application</label>\n                  <div class="controls">\n                    <div>\n                      <input checked="checked" class="radio_buttons required radio" data-status-text="Published" id="exhibit_8_status_published" name="exhibit[status]" type="radio" value="published"><label class="radio" for="exhibit_8_status_published">\n                        <div class="label-content">\n                          <i class="icon-globe"></i> Everyone\n                        </div>\n                      </label>\n                    </div>\n                    <div>\n                      <input class="radio_buttons required radio" data-status-text="Limited" id="exhibit_8_status_limited" name="exhibit[status]" type="radio" value="limited"><label class="radio" for="exhibit_8_status_limited">\n                        <div class="label-content">\n                          <i class="icon-user"></i> Only users who have passcode\n                        </div>\n                      </label>\n                      <div class="limited-pass-hint hidden">\n                        <div class="limited-pass">\n                          pzicen\n                        </div>\n                        <a href="/1/content_provider/edit#passcode" target="_blank">Edit</a>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </form>\n            </div>\n          </ul>\n        </div>\n      </div>\n    </div>\n  </div>\n</li>'},h=function(){return Math.round(10*Math.random()+11)},$("#create_new_item").click(function(){var i,n,a;return n=$("ul.exhibits"),n.find("li.dummy").length>0?!1:(a=h(),i=$(y(a)),n.append(i),e(),r=$(".exhibits>li.exhibit"),t(r,j,q,C),n.find("li.dummy").find(".opener .description").click(),o.find("#name").blur(function(){var e,i;return i=$(this),""!==i.val()?(e=m(),e.removeClass("dummy").find(".opener").removeClass("draft"),o.find(".item_publish_settings").show(),o.find(".done").show(),o.find(".close").hide(),o.find(".delete_story").removeClass("no_margin")):void 0}),!1)}),k=$("a.thumb"),$("#images, #maps").find("li.new").on("click","a.upload-image, a.upload-map",function(e){var i,n;return e.preventDefault(),n=$(this),i=n.parents("#images, #maps"),i.find("li:hidden").isEmpty()&&$.ajax({url:n.attr("href"),async:!1,success:function(t){var a;return a=$(t).hide(),i.find("li.new").before(a),initFileUpload(e,a.find(".fileupload"),{progress:n.find(".progress")})}}),i.find("li:hidden :file").trigger("click")}),$("#images, #maps").on("click","a.remove",function(e){var i,n;return e.preventDefault(),e.stopPropagation(),n=$(this),i=n.parents("#images, #maps"),confirm(n.data("confirm"))?$.ajax({url:n.attr("href"),type:n.data("method"),data:{authentity_token:$("meta[name=csrf-token]").attr("content")},success:function(){var e;return e=200,i.attr("id").match(/images/)?n.parents("li").fadeOut(e,function(){return $(this).remove(),k.trigger("image:deleted")}):n.parents("li").fadeOut(e,function(){return $(this).remove()})}}):void 0}),$("#images, #maps").find(">ul[data-liftable]").each(function(){var e,i,n;return e=$(this),i=e.parents("#images, #maps"),n=function(){var n;return n=e.sortable("serialize"),n+="&"+$("meta[name=csrf-param]").attr("content")+"="+encodeURIComponent($("meta[name=csrf-token]").attr("content")),$.ajax({type:"post",data:n,dataType:"script",url:e.data("sort-url"),success:function(){return i.attr("id").match(/images/)?k.trigger("image:moved"):void 0}})},e.disableSelection().sortable({axis:"xy",cursor:"move",update:n,items:"li[id]"})}),k.on("click",function(e){return e.preventDefault(),$("div.tab-pane#images").each(function(){return $("div.tab-pane, ul.nav-pills li").removeClass("active"),$(this).addClass("active"),imagesTab.parent("li").addClass("active")})}),w=function(){return $.ajax({url:k.data("reload-url"),type:"get",success:function(e){var i,n;return i=e.thumb||k.data("default-url"),e.thumb&&(i+="?_="+(new Date).getTime()),n=imagesTab.text().replace(/\d+/,e.count),k.find("img").attr("src",i),imagesTab.text(n)}})},D=function(){var e,i,n,t,a,s,r,d;return r="li:not(.new)",s=$(".images-list"),e=s.find(".images-displayed"),d=e.data("max-displayed"),i=e.find(r).length,a=s.find(".images-hidden"),n=function(){return a.find(r).length},t=s.find(".hidden-header"),i>d?e.find(""+r+":last").prependTo(a):d>i&&n()>0&&a.find(""+r+":first").appendTo(e),t.toggleClass("hidden",0===n())},x=function(){return w(),D()},k.on("image:uploaded",x),k.on("image:cropped",w),k.on("image:deleted",x),k.on("image:moved",x)})}).call(this);