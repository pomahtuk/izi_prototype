!function(){var n,i,e,t;e=function(n){var i,e;return n=$(n),e=n.offset().top,i=function(){return e<$(this).offset().top},$.merge(n,n.nextUntil(i)).last()},i=function(n,i){return n.length>0&&i.length>0&&n.offset().top===i.offset().top},n=function(){var n;return n=null,function(i,e){return n&&n.abort(),n=$.getJSON(i,function(n){return e(n)})}}(),t=function(n,i,e,t){var a,s,r,o,d,l;return l=$(window).innerWidth(),o=i+e,d=l-2*t+e,s=Math.floor(d/o),a=l-(s*o-e),r=Math.floor(a/2),n.css({"margin-right":0,"margin-left":e}),n.each(function(n){return 0===n%s?$(this).css({"margin-left":r}):void 0})},$(function(){var n,a,s,r,o,d,l,u,c,h,p,v,m,f,b,g,_,x,y;return r=$(".exhibits>li.exhibit"),_=59,y=r.width(),x=parseInt(r.css("margin-left"))+parseInt(r.css("margin-right")),$(".exhibits").css({"text-align":"left"}),t(r,y,x,_),$(window).resize(t.bind(this,r,y,x,_)),d=$("#drop_down").remove().removeClass("hidden"),b=[],c=function(){return $("ul.exhibits li.active")},u=function(n){var i;return d.find("p").html(n.description),n.images.length>1?(i=n.images.map(function(n){return'<img src="'+n.big_url+'">'}).join(""),d.find(".slides").html(i).slidesjs(slidesjs_options)):void 0},s=function(){var n,i,e,t,a,s,r;if(n=c(),n.hasClass("dummy")&&""===d.find("#name").val()){for(t=!0,r=d.find("#media .form-control:not(#opas_number)"),a=0,s=r.length;s>a;a++)i=r[a],i=$(i),""!==i.val()&&(t=!1);t?n.remove():(e=n.data("number"),$("ul.exhibits").append(v(e)),$("#dummyModal").modal({show:!0,backdrop:"static"}),$("#dummyModal").find(".btn-default").click(function(){return n.remove(),$("#dummyModal, .modal-backdrop").remove()}),$("#dummyModal").find(".btn-primary").click(function(){return n.removeClass("dummy"),d.find("#name").val("item_"+e),n.find(".opener").removeClass("draft"),$("#dummyModal, .modal-backdrop").remove()}))}return d.remove(),n.removeClass("active")},a=function(n){var i;return i=d.parent().length>0,d.insertAfter(e(n)),i?void 0:(d.find("a.done").unbind("click").bind("click",function(n){return n.preventDefault(),s()}),d.find(">.prev-ex").unbind("click").bind("click",function(n){var i,e;return n.preventDefault(),i=c(),e=i.prev(".exhibit"),"drop_down"===e.attr("id")&&(e=e.prev()),e.length>0?e.find(".opener .description").click():i.siblings(".exhibit").last().find(".opener").click()}),d.find(">.next-ex").unbind("click").bind("click",function(n){var i,e;return n.preventDefault(),i=c(),e=i.next(),"drop_down"===e.attr("id")&&(e=e.next()),e.length>0?e.find(".opener .description").click():i.siblings(".exhibit").first().find(".opener").click()}),d.find(".label-content").unbind("click").bind("click",function(){var n,i;return n=$(this),i=n.parents(".dropdown-menu").prev(".dropdown-toggle"),n.hasClass("everyone")?i.html("<div class='extra'><i class='icon-globe'></i></div><span class='caret'></span>"):i.html("<div class='extra'><i class='icon-user'></i></div> Publish <span class='caret'></span>")}),d.find("#delete_story input[type=radio]").unbind("change").bind("change",function(){var n,i;return i=$(this),n=$("#delete_story"),"lang_selected"!==i.attr("id")?$("#delete_story .other_variants").slideUp(150):i.is(":checked")?$("#delete_story .other_variants").slideDown(150):void 0}),$("#story_quiz_enabled, #story_quiz_disabled").unbind("change").bind("change",function(){var n,i;return n=$(this),i=d.find(".form-wrap"),console.log(n.val()),"story_quiz_enabled"===n.attr("id")?($("label[for=story_quiz_enabled]").text("Enabled"),$("label[for=story_quiz_disabled]").text("Disable"),!0):($("label[for=story_quiz_disabled]").text("Disabled"),$("label[for=story_quiz_enabled]").text("Enable"),!0)}))},$(window).resize(function(){return c().each(function(){return d.remove(),a(this)}),m(),l()}),p=function(n){return $(".icon-question-sign").each(function(){return $(this).is(n)||0!==$(this).has(n).length||0!==$(".popover").has(n).length?void 0:$(this).popover("hide")})},l=function(){return $(".form-group").each(function(n,i){var e;return i=$(i),e=i.find(".triggered > *").val(),i.find("span.placeholder").text(e),i.find(".save_status").html('<i class="icon-ok-sign"></i>saved'),""===e?(i.find(".trigger").hide(),i.find(".triggered").show().focus()):void 0}),$("span.placeholder").unbind("click").bind("click",function(){var n,i,e;return n=$(this),i=n.parents(".trigger"),e=i.next(),i.hide(),e.show().children().first().val(n.text()).focus()}),$(".triggered > *").unbind("blur").bind("blur",function(){var n,i,e,t;return n=$(this),i=n.parents(".triggered"),t=i.prev(),""!==n.val()&&(i.hide(),t.show().find("span").text(n.val())),e=t.parent(".form-group").find(".save_status"),e.fadeIn(300),setTimeout(function(){return e.fadeOut(300)},800)}),$("i.icon-question-sign").popover(),$(".form-group").unbind("mouseenter").bind("mouseenter",function(n){return p(n.target)}),$("body").on("click",function(n){return p(n.target)}),$("a.other_lang").unbind("click").bind("click",function(){var n;return n=$(this),n.next("ul").toggleClass("hidden"),!1})},m=function(){var n,i,e,t;return i=$("ul.museum_list"),n=i.find("li").length,t=$("body").width(),e=(150*n+160)/t,e>1?($(".museum_filters").show(),i.width(t-200)):($(".museum_filters").hide(),i.width(t-100))},f=function(){return $(".museum_navigation_menu .search").click(function(){var n;return n=$(this),n.hide(),n.next().show().children().first().focus()}),$(".museum_navigation_menu .search_input input").blur(function(){var n,i;return n=$(this),i=n.parents(".search_input"),n.animate({width:"150px"},150,function(){return i.hide(),i.prev().show()})}),$(".museum_navigation_menu .search_input input").focus(function(){var n,i;return n=$(this),i=$("body").width()-700,i>150?n.animate({width:""+i+"px"},300):void 0}),$(".museum_navigation_menu .search_input input").keyup(function(){var n,i,e,t,a,s,r,o;for(i=$(this),a=i.val().toLowerCase(),t=$("ul.museum_list > li"),0!==a.length?$(".museum_filters a").removeClass("active"):$(".museum_filters a").first().addClass("active"),o=[],n=s=0,r=b.length;r>s;n=++s)e=b[n],-1===e.indexOf(a)?o.push($(t[n]).hide(100)):o.push($(t[n]).show(100));return o}),$(".museum_navigation_menu .search_input .search_reset").click(function(){return $(".museum_navigation_menu .search_input input").val("").keyup()})},o=function(){var n,i,e,t,a;for(i=$("ul.museum_list > li"),a=[],e=0,t=i.length;t>e;e++)n=i[e],n=$(n),a.push(b.push(""+n.find("h4").text().trim().toLowerCase()));return a},m(),o(),f(),$(".filter_opener").click(function(n){var i,e,t;return n.preventDefault(),i=$(this),e=$(".filters_bar"),t=$(".navigation"),i.hasClass("active")?(e.css({overflow:"hidden"}),e.animate({height:"0px"},200),i.removeClass("active"),t.hasClass("navbar-fixed-top")?$("body").animate({"padding-top":"-=44px"},200):void 0):(e.animate({height:"44px"},200,function(){return e.css({overflow:"visible"})}),t.hasClass("navbar-fixed-top")&&$("body").animate({"padding-top":"+=44px"},200),i.addClass("active"))}),$(".menu_opener").click(function(){var n,i,e,t;return n=$(this),i=$(".museum_navigation_menu"),e=$(".navigation"),i.is(":visible")?(t=n.data("last-padding"),i.slideUp(300),e.addClass("navbar-fixed-top"),$("body").css({"padding-top":""+t})):(t=$("body").css("padding-top"),n.data("last-padding",t),i.slideDown(300),e.removeClass("navbar-fixed-top"),$("body").css({"padding-top":"0px"}))}),$("ul.exhibits>li:not(#drop_down) .checkbox input").change(function(){var n,i;return n=$(this),i=n.parents(".opener"),n.is(":checked")?i.addClass("border"):i.removeClass("border")}),$(".actions_bar input.search").focus(function(){var n,i;return n=$(this),i=$("body").width()-700,i>150?n.animate({width:""+i+"px"},300):void 0}),$(".actions_bar input.search").blur(function(){var n;return n=$(this),n.animate({width:"150px"},300)}),n=function(){return $("ul.exhibits>li:not(#drop_down)>.opener .description, ul.exhibits>li:not(#drop_down)>.opener .overlay").unbind("click").bind("click",function(){var n,e,t;return n=$(this).closest("li"),n.hasClass("active")?(s(),!1):(t=c(),t.removeClass("active"),n.addClass("active"),d.find("h2").text(n.find("h4").text()),i(n,t)||(a(n),$("body").scrollTo(n,500,150)),l(),$("#jquery_jplayer_1").jPlayer({ready:function(){return $(this).jPlayer("setMedia",{m4a:"http://www.jplayer.org/audio/m4a/TSP-01-Cro_magnon_man.m4a",oga:"http://www.jplayer.org/audio/ogg/TSP-01-Cro_magnon_man.ogg"})},swfPath:"/js",wmode:"window",preload:"auto",smoothPlayBar:!0,keyEnabled:!0,supplied:"m4a, oga"}),n.hasClass("dummy")?(e=n.data("number"),$("#opas_number").val(e).blur(),$("#name").focus()):void 0)})},n(),v=function(n){return'<div class="modal fade" id=\'dummyModal\'>\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        <h4 class="modal-title">Name of exhibit is empty</h4>\n      </div>\n      <div class="modal-body row">\n        <div class="pull-right">\n          <button type="button" class="btn btn-default" data-dismiss="modal">Discard exhibit</button>\n          <button type="button" class="btn btn-primary" data-dismiss="modal">Save as "item_'+n+'"</button>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'},g=function(n){return'<li class="exhibit dummy" data-big-image=/img/img-bg.png" data-number=\''+n+'\'>\n  <div class="opener draft">\n    <div class="overlay"></div>\n    <div class="checkbox">\n      <input type="checkbox">\n    </div>\n    <div class="image">\n      <img data-src="" src="/img/img-bg.png">\n    </div>\n    <div class="description">\n      <h4>\n        '+n+". item_"+n+'\n      </h4>\n    </div>\n    <div class="visibility">\n      <i class="icon-globe placeholder"></i>\n      <div class="on_hover">\n        <div class="btn-group">\n          <button class="btn btn-default dropdown-toggle" data-toggle="dropdown" type="button">\n            <div class="extra_right">\n              <i class="icon-globe"></i>\n            </div>\n            <span class="caret"></span></button>\n          <ul class="dropdown-menu" role="menu">\n            <div class="status-select-dropdown">\n              <form accept-charset="UTF-8" action="/1/museums/1/exhibits/8" class="simple_form status-select-inline" data-remote="true" id="edit_exhibit_8" method="post" novalidate="novalidate">\n                <div style="margin:0;padding:0;display:inline">\n                  <input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="oE0Ns9ypDjsWQrc0VHdsAqhAgEz0Q8Lx8pJQlyqQaq0=">\n                </div>\n                <div class="status-select control-group radio_buttons required">\n                  <label class="radio_buttons required control-label">\n                    <div class="required-symbol">\n                      <abbr title="required"></abbr>\n                    </div>\n                    Who can see it in mobile application</label>\n                  <div class="controls">\n                    <div>\n                      <input checked="checked" class="radio_buttons required radio" data-status-text="Published" id="exhibit_8_status_published" name="exhibit[status]" type="radio" value="published"><label class="radio" for="exhibit_8_status_published">\n                        <div class="label-content">\n                          <i class="icon-globe"></i> Everyone\n                        </div>\n                      </label>\n                    </div>\n                    <div>\n                      <input class="radio_buttons required radio" data-status-text="Limited" id="exhibit_8_status_limited" name="exhibit[status]" type="radio" value="limited"><label class="radio" for="exhibit_8_status_limited">\n                        <div class="label-content">\n                          <i class="icon-user"></i> Only users who have passcode\n                        </div>\n                      </label>\n                      <div class="limited-pass-hint hidden">\n                        <div class="limited-pass">\n                          pzicen\n                        </div>\n                        <a href="/1/content_provider/edit#passcode" target="_blank">Edit</a>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </form>\n            </div>\n          </ul>\n        </div>\n      </div>\n    </div>\n  </div>\n</li>'},h=function(){return Math.round(10*Math.random()+11)},$("#create_new_item").click(function(){var i,e,t;return i=$("ul.exhibits"),i.find("li.dummy").length>0?!1:(t=h(),e=g(t),i.append(e),n(),i.find("li.dummy").find(".opener .description").click(),d.find("#name").blur(function(){var n,i;return i=$(this),""!==i.val()?(n=c(),n.removeClass("dummy").find(".opener").removeClass("draft")):void 0}),!1)})})}.call(this);